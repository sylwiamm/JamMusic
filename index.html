<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jam Music Lab</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

    body {
      margin: 0;
      padding: 0;
      font-family: 'Courier Prime', monospace;
      background-color: white;
      overflow: hidden;
    }

    .container {
      width: 100%;
      height: 100vh;
      position: relative;
    }

    h1 {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #333;
      margin: 0;
      font-size: 24px;
      font-weight: bold;
      z-index: 10;
      text-decoration: underline;
    }

    .subtitle {
      position: absolute;
      top: 60px;
      left: 20px;
      color: #333;
      margin: 0;
      font-size: 14px;
      max-width: 450px;
      line-height: 1.3;
      z-index: 10;
    }

    svg {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mapping the Sound</h1>
    <p class="subtitle">
      Visualizing the Global Reach of Vienna's Jam Music Lab Faculty Through Concerts, Tours, and Collaborations
    </p>
    <svg id="mapSvg"></svg>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
  <script>
    // Resize function to handle window resizing
    function resizeMap() {
      const width = window.innerWidth;
      const height = window.innerHeight;

      // Clear previous content
      d3.select("#mapSvg").html("");

      // Set SVG dimensions
      d3.select("#mapSvg")
        .attr("width", width)
        .attr("height", height);

      drawMap(width, height);
    }

    // Initial setup and draw
    window.addEventListener('resize', resizeMap);
    resizeMap();

    function drawMap(width, height) {
      // Define margins
      const margin = {
        top: 100,    // Extra space for title
        right: 50,
        bottom: 50,
        left: 50
      };

      // Adjust dimensions to account for margins
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;

      // Get SVG element
      const svg = d3.select("#mapSvg");

      // Create a group for the map with margins applied
      const mapGroup = svg.append("g")
        .attr("transform", `translate(${margin.left}, ${margin.top})`);

      // Create projection - adjusted to show New Zealand properly
      const projection = d3.geoMercator()
        .scale(innerWidth / 2 / Math.PI)
        .translate([innerWidth / 2, innerHeight / 1.5])
        // Adjust center longitude to move New Zealand to the left side
        .rotate([-10, 0, 0]);

      // Create path generator
      const path = d3.geoPath()
        .projection(projection);

      // Create a dot pattern definition
      const defs = svg.append("defs");
      const dotSize = Math.max(2, Math.min(0.8, width / 1500));
      const spacing = Math.max(1, Math.floor(5 * (width / 1200)));

      const pattern = defs.append("pattern")
        .attr("id", "dotPattern")
        .attr("width", spacing)
        .attr("height", spacing)
        .attr("patternUnits", "userSpaceOnUse");

      pattern.append("circle")
        .attr("cx", spacing / 2)
        .attr("cy", spacing / 2)
        .attr("r", dotSize)
        .attr("fill", "#e8e8e8");

      // Load world map data
      d3.json("data/world.json")
        .then(function(world) {
          // Get countries features
          const countries = topojson.feature(world, world.objects.countries);

          // Draw countries with pattern
          mapGroup.append("g")
            .selectAll("path")
            .data(countries.features)
            .join("path")
            .attr("d", path)
            .attr("fill", "url(#dotPattern)")
            .attr("stroke", "none");
        })
        .catch(function(error) {
          console.error("Error loading map data:", error);
          svg.append("text")
            .attr("x", width / 2)
            .attr("y", height / 2)
            .attr("text-anchor", "middle")
            .text("Error loading map data. Please check console for details.");
        });
    }
  </script>
</body>
</html>
